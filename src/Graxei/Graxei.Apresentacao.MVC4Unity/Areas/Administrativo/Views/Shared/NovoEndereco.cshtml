@model Graxei.Transversais.ContratosDeDados.EnderecoContrato

@{
    string target = "listaEnd";
    string toggle = "$('#ModalNovoEndereco').modal('toggle')";
    if (!ViewData.ModelState.IsValid)
    {
        target = "ModalNovoEndereco";
        toggle = string.Empty;
    }
    AjaxOptions ajax = new AjaxOptions() { HttpMethod = "POST", OnSuccess = toggle, UpdateTargetId = target };   
}
@using (Ajax.BeginForm("Novo", "Enderecos", ajax, new { @class = "form-horizontal", role = "form" }))
{
    <div class="modal fade" id="ModalNovoEndereco" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h3 id="myModalLabel">@Rotulos.NovoEndereco</h3>
                </div>
                <div class="modal-body">
                    @Html.ValidationSummary(true)
                    <div class="row form-group">
                        @Html.Bootstrap().Label(Rotulos.Estado).Width(InputWidth.Col_2).HtmlAttributes(new { @class = "control-label" })
                        @Html.Bootstrap().DropDownListFor(m => m.IdEstado, (SelectList)ViewBag.Estados).Width(InputWidth.Col_3).HtmlAttributes(new
                                                                                                                                                   {
                                                                                                                     id = "idEstado",
                                                                                                                                                       @class = "form-control"
                                                                                                                                                   }).ShowValidationMessage(true)
                        @Html.Bootstrap().Label(Rotulos.Cidade).Width(InputWidth.Col_2).HtmlAttributes(new { @class = "control-label" })
                        @Html.Bootstrap().TypeHeadFor(m => m.Cidade, "AutoCompleteCidade", "Enderecos").Id("nomeCidade").Width(InputWidth.Col_5).HtmlAttributes(new { @class = "form-control" }).ShowValidationMessage(true).ShowValidationMessage(true)
                    </div>
                    <div class="row form-group">
                        @Html.Bootstrap().Label(Rotulos.Bairro).Width(InputWidth.Col_2).HtmlAttributes(new { @class = "control-label" })
                        @Html.Bootstrap().TypeHeadFor(m => m.Bairro, "AutoCompleteBairro", "Enderecos").Id("nomeBairro").Width(InputWidth.Col_10).HtmlAttributes(new { @class = "form-control" }).ShowValidationMessage(true)
                    </div>
                    <div class="row form-group">
                        @Html.Bootstrap().LabelFor(m => m.Logradouro).Width(InputWidth.Col_2).HtmlAttributes(new { @class = "control-label" })
                        @Html.Bootstrap().TypeHeadFor(m => m.Logradouro, "AutoCompleteLogradouro", "Enderecos").Id("logradouro").Width(InputWidth.Col_10).HtmlAttributes(new { @class = "form-control" }).ShowValidationMessage(true)
                    </div>
                    <div class="row form-group">
                        @Html.Bootstrap().LabelFor(m => m.Numero).Width(InputWidth.Col_2).HtmlAttributes(new { @class = "control-label" })
                        @Html.Bootstrap().TextBoxFor(m => m.Numero).Id("numero").Width(InputWidth.Col_10).HtmlAttributes(new { @class = "form-control" }).ShowValidationMessage(true)
                    </div>
                    <div class="row form-group">
                        @Html.Bootstrap().ControlGroup().TextAreaFor(m => m.Complemento).Id("complemento").HtmlAttributes(new { @class = "form-control" }).Rows(3).Label().Width(InputWidth.Col_2).HtmlAttributes(new { @class = "control-label" })
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">@Rotulos.Fechar</button>
                    <input type="submit" class="btn btn-primary" value="@Rotulos.Salvar"/>
                </div>
            </div>
        </div>
    </div>
}
<script type="text/javascript">

    $(document).ready(function () {
        $("#IdEstado").change(function () {
            var estadoSel = $("#IdEstado").val();
            if (estadoSel != 0) {
                var url = '@Url.Action("EstadoSelecionado", "Enderecos")';
                $.post(url, { idEstado: estadoSel },
                    function (data) {
                    });
            }
        });
        $(document).on("blur", "#IdCidade", function () {
            var estadoSel = $("#IdEstado").val();
            var cidadeDig = $(this).val();
            var url = '@Url.Action("CidadeSelecionada", "Enderecos")';
            $.post(url, { idEstado: estadoSel, valCidade: cidadeDig }, function (data) { });
        });
        $(document).on("blur", "#IdBairro", function () {
            var estadoSel = $("#IdEstado").val();
            var cidadeSel = $("#IdCidade").val();
            var bairroDig = $(this).val();
            var url = '@Url.Action("BairroSelecionado", "Enderecos")';
            $.post(url, { idEstado: estadoSel, valCidade: cidadeSel, valBairro: bairroDig }, function (data) { });
        });
    });
</script>
<script src="@Url.Content("~/Scripts/autocomplete.js")" type="text/javascript"></script>

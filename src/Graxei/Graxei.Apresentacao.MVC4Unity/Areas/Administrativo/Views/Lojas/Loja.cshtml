@model LojaModel
@{
    ViewBag.Title = Rotulos.NovaLoja;
}
@Styles.Render("~/Content/themes/base/css")
@Scripts.Render("~/bundles/jqueryui")

<script type="text/javascript">

    $("#IdEstado").live("change", (function () {
        var estado = $("#IdEstado").val();
        ////alert('aaa');
        if (estado != 0) {
            var url = '@Url.Action("EstadoSelecionado", "Enderecos")';
                $.post(url, { idEstado: estado },
                    function () {
                    });
            }
        })
        );

        $("#IdCidade").live("blur", function () {
            var estado = $("#IdEstado").val();
            var nomeCidade = $("#IdCidade").val();
            if (estado > 0 && nomeCidade.length > 0) {
                var url = '@Url.Action("CidadeSelecionada", "Enderecos")';
                $.post(url, { idEstado: estado, cidade: nomeCidade },
                    function () {
                    });
            }
        });

        $("#IdBairro").live("blur", function () {
            var idEstado = $("#IdEstado").val();
            var nomeCidade = $("#IdCidade").val();
            var nomeBairro = $("#IdBairro").val();
            if (idEstado > 0 && nomeCidade.length > 0 && nomeBairro.length > 0) {
                var url = '@Url.Action("BairroSelecionado", "Enderecos")';
                    $.post(url, { estado: idEstado, cidade: nomeCidade, bairro: nomeBairro },
                        function () {
                        });
                }
            });

            $("#IdCidade").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: "@Url.Action("AutoCompleteCidade", "Enderecos")",
                    type: "POST",
                    dataType: "json",
                    data: { term: request.term },
                    success: function (data) {
                        response($.map(data, function (item) {
                            return { value: item };
                        }));
                    }
                });
            },
        });

        $("#IdBairro").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "@Url.Action("AutoCompleteBairro", "Enderecos")",
                    type: "POST",
                    dataType: "json",
                    data: { term: request.term },
                    success: function (data) {
                        response($.map(data, function (item) {
                            return { value: item };
                        }));
                    }
                });
            },
        });

        $("#IdLogradouro").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: "@Url.Action("AutoCompleteLogradouro", "Enderecos")",
                    type: "POST",
                    dataType: "json",
                    data: { term: request.term },
                    success: function (data) {
                        response($.map(data, function (item) {
                            return { value: item };
                        }));
                    }
                });
            },
        });

        function SuccessEndereco(result) {
            if (result.Mensagem === undefined) {
                //var divLista = document.getElementById("listaEnderecos");
                //divLista.innerHTML = result;
                $("#modalEnderecos").modal('hide');
            } else {
                var divErro = document.getElementById("validationEndereco");
                divErro.innerHTML = "<div class='alert alert-danger'><div class='row'><div class='col-md-1'><i class='glyphicon glyphicon-remove'></i></div><div class='col-md-11'><ul style='margin: 0;'>" + result.Mensagem + "</ul></div></div>";
            }
        }

        function resetModal() {
            ////document.getElementById("form-enderecos").reset();
            //var idLoja = document.getElementById("idnovaloja").value;
            //var idLojaEndereco = document.getElementById("idlojaendereco");
            //document.getElementById("idHiddenEndereco").value = "";
            //idLojaEndereco.value = idLoja;
            $('#modalEnderecos').modal('show');
        }

        function editarEndereco(id) {
            $.ajax({
                url: "@Url.Action("Get", "Enderecos")",
                type: "GET",
                data: { idEndereco: id },
                success: function (data) {
                    document.getElementById("idlojaendereco").value = data.IdLoja;
                    document.getElementById("IdCidade").value = data.Cidade;
                    document.getElementById("IdBairro").value = data.Bairro;
                    document.getElementById("IdLogradouro").value = data.Logradouro;
                    document.getElementById("IdNumero").value = data.Numero;
                    document.getElementById("IdComplemento").value = data.Complemento;
                    document.getElementById("IdTelefones").value = data.Telefones;
                    document.getElementById("idHiddenEndereco").value = data.Id;
                    document.getElementById("IdEstado").value = data.IdEstado;
                    $('#modalEnderecos').modal('show');
                }
            });
        }
</script>

<div id="novaloja">
    @{Html.RenderPartial("Nova", Model);}
</div>

@*<h5>@Rotulos.Enderecos</h5>
<div id="listaEnderecos"></div>
<div id="enderecoAtualizar">
    @{ Html.RenderAction("NovoEndereco", "Enderecos", Model.EnderecoModel); }
</div>*@

@model Graxei.Apresentacao.MVC4Unity.Models.PesquisarModel
<div>
    <div id="clock2">@ViewBag.TempoBusca seg</div>
</div>

@{int idxRow = 0;}
@foreach (Graxei.Transversais.ContratosDeDados.PesquisaContrato pv in Model.PesquisaContrato)
{
    <div class="row row@(idxRow % 2)">
        <div class="col-md-12">
            <div class="thumbnail thumbnail-search">
                <div class="row">
                    <div class="col-md-2 col-sm-2">
                        @Ajax.ImageActionLink(new ImageTag() { Src = Url.Action("GetThumbnail", "Home", new { idProduto = pv.ProdutoId }), Width = 41, Height = 41 },
"", "VerLoja", "Loja", new { Controller = "Loja", IdEndereco = pv.EnderecoId }, new AjaxOptions() { UpdateTargetId = "myModal" }, new { @class = "thumbnail thumbnail-search" })
                        @Ajax.ActionLink("Detalhes da Loja", "VerLoja", "Loja", new { IdEndereco = pv.EnderecoId }, new AjaxOptions() { UpdateTargetId = "myModal" }, new { @class = "thumbnail thumbnail-search" })
                    </div>
                    <div class="col-md-8 col-sm-8">
                        <div class="row">
                            <div class="col-md-8">
                                <h4>@pv.Codigo</h4>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                @pv.DescricaoExibir
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2 col-sm-2">
                        <div class="bs-callout bs-callout-info">
                            <h4>R$@pv.Preco</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    idxRow++;
}
<div class="row pag-btn-group">
    <div class="span12">
        @{
            long idx = ((ViewBag.PesquisarModel.PaginaSelecionada <= 2) ? 0 : ViewBag.PesquisarModel.PaginaSelecionada - 2);

            long mIdx = ViewBag.PesquisarModel.NumeroMaximoPagina != null ? ViewBag.PesquisarModel.NumeroMaximoPagina : (idx + 2);
            if ((mIdx - idx) < 3 && ViewBag.PesquisarModel.NumeroMaximoPagina == null)
            {
                mIdx = mIdx + (mIdx - idx);
            }
            @Ajax.LinkPaginacaoRangePagina("PesquisarPagina", "Home", "paginaSelecionada", (int)ViewBag.PesquisarModel.PaginaSelecionada, mIdx, 2)
        }
    </div>
</div>

<a data-ajax="true" data-ajax-mode="replace" data-ajax-update="#myModal" href="/Home/ContatoAnuncioModal">
    <div class="mark mark-r">
        <div class="m1">Anuncie </div>
        <div class="m2">Aqui</div>
    </div>
</a>
@if (ViewBag.newq != null)
{
    <script>
        function teste() {
            var newurl = window.location.protocol + "//" + window.location.host /*+ window.location.pathname */ + '?q=@ViewBag.newq';
            window.history.pushState({ path: newurl }, '', newurl);

            var q = "@ViewBag.newq";
            var idxLoja = q.toLowerCase().indexOf("loja:");
            if (idxLoja >= 0) {
                var idxLojaFim = q.toLowerCase().indexOf(" ", idxLoja)
                var loja = q.substring(idxLoja + 5);

                if (idxLojaFim > 0) {
                    loja = q.substring(idxLoja + 5, idxLojaFim);
                }
                sessionStorage.setItem("lojaNome_graxei", loja);
                $("#q").val(q.toLowerCase().replace("loja:" + loja, "").trim());
                var lojaApresentacao = loja;
                if (lojaApresentacao.length > 4) {
                    lojaApresentacao = lojaApresentacao.substr(0, 4) + "...";
                }
                $("#lbl-loja-nome").text(lojaApresentacao);
                $("#lojaNome").val(loja);
                $(".label-search").css("visibility", "visible");
            }

            if (sessionStorage.getItem("lojaNome_graxei") != "") {
                $(".label-search").css("visibility", "visible");
            }
        }
        function InsertUrlLojaProdutos() {
            $("#q").val("@ViewBag.newq");

            teste();
            $("#lbl-loja-nome").val(sessionStorage.getItem("lojaNome_graxei"));
        }
    </script>
}
else
{
    <script>
        function teste() {
        }
        function InsertUrlLojaProdutos() { }
    </script>
}
@model Graxei.Apresentacao.Models.EnderecoVistaModel
<div id="appEnderecos">
    <div ng-controller="EnderecoController as enderecoCtrl">
        <div id="modalEnderecos" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-dialog-endereco">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    </div>
                    <div class="modal-body" ng-init="enderecoCtrl.getData(@Model.IdLoja, @Model.IdEndereco)">
                        <div ng-show="enderecoCtrl.operacao.renderizar" class="col-lg-offset-1 col-lg-11">
                            <div ng-class="{'alert-danger': !enderecoCtrl.operacao.ok, 'alert-success': enderecoCtrl.operacao.ok}" class="alert row" role="alert">
                                <div class="col-md-1">
                                    <i class="glyphicon" ng-class="{'glyphicon-ok': enderecoCtrl.operacao.ok, 'glyphicon-alert': !enderecoCtrl.operacao.ok}"></i>
                                </div>
                                <div class="col-md-10" ng-show="enderecoCtrl.operacao.errosValidacao == undefined">
                                    {{enderecoCtrl.operacao.mensagem}}
                                </div>
                                <div class="col-md-10" ng-show="enderecoCtrl.operacao.errosValidacao.length > 0">
                                    <div class="row">@Validacoes.CorrijaValores</div>
                                    <ul ng-repeat="errosValidacao in enderecoCtrl.operacao.errosValidacao">
                                        <li>{{errosValidacao}}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <form name="enderecoForm" class="form-horizontal" ng-submit="enderecoForm.$valid && enderecoCtrl.salvar()" novalidate>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <div class="control-label col-md-2">
                                            <label>@Rotulos.CNPJ</label>
                                        </div>
                                        <div class="col-md-4">
                                            <input class="form-control" name="cnpj" data-val="true" ng-model="enderecoCtrl.endereco.cnpj" focus ng-maxlength="50" />
                                            <span ng-messages="enderecoForm.cnpj.$error" ng-show="enderecoForm.cnpj.$dirty || enderecoForm.$submitted">
                                                <span ng-message="required">@Validacoes.CnpjObrigatorio</span>
                                                <span ng-message="maxLength">@Validacoes.TamanhoMaximo50</span>
                                            </span>
                                        </div>
                                        <div class="control-label col-md-1">
                                            <label>@Rotulos.Estado</label>
                                        </div>
                                        <div class="col-md-2">
                                            @Html.DropDownList("estado", Model.Estados, htmlAttributes: new { @class = "form-control", ng_Model = "enderecoCtrl.endereco.idEstado", required = "", ng_change = "enderecoCtrl.alterarEstado(enderecoForm.estado.$viewValue)" })
                                            <span ng-messages="enderecoForm.estado.$error" ng-show="enderecoForm.estado.$dirty || enderecoForm.$submitted">
                                                <span ng-message="required">@Validacoes.EstadoObrigatorio</span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <div class="control-label col-md-2">
                                            <label>@Rotulos.Cidade</label>
                                        </div>
                                        <div class="col-md-10">
                                            <input type="text" name="cidade" class="form-control" ng-model="enderecoCtrl.endereco.cidade" typeahead="response for response in enderecoCtrl.getCidades($viewValue)" ng-blur="enderecoCtrl.alterarCidade(enderecoForm)">
                                            <span ng-messages="enderecoForm.cidade.$error" ng-show="enderecoForm.cidade.$dirty || enderecoForm.$submitted">
                                                <span ng-message="required">@Validacoes.CidadeObrigatoria</span>
                                                <span ng-message="maxLength">@Validacoes.TamanhoMaximo250</span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <div class="control-label col-md-2">
                                            <label>@Rotulos.Bairro</label>
                                        </div>
                                        <div class="col-md-10">
                                            <input type="text" name="bairro" class="form-control" ng-model="enderecoCtrl.endereco.bairro" typeahead="response for response in enderecoCtrl.getBairros($viewValue)" ng-blur="enderecoCtrl.alterarBairro(enderecoForm)" required>
                                            <span ng-messages="enderecoForm.bairro.$error" ng-show="enderecoForm.bairro.$dirty || enderecoForm.$submitted" ng-maxlength="250">
                                                <span ng-message="required">@Validacoes.BairroObrigatorio</span>
                                                <span ng-message="maxLength">@Validacoes.TamanhoMaximo250</span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <div class="control-label col-md-2">
                                            <label>@Rotulos.Logradouro</label>
                                        </div>
                                        <div class="col-md-10">
                                            <input type="text" name="logradouro" class="form-control" ng-model="enderecoCtrl.endereco.logradouro" typeahead="response for response in enderecoCtrl.getLogradouros($viewValue)" required>
                                            <span ng-messages="enderecoForm.logradouro.$error" ng-show="enderecoForm.logradouro.$dirty || enderecoForm.$submitted">
                                                <span ng-message="required">@Validacoes.LogradouroObrigatorio</span>
                                                <span ng-message="maxLength">@Validacoes.TamanhoMaximo250</span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <div class="control-label col-md-2">
                                            <label>@Rotulos.Numero</label>
                                        </div>
                                        <div class="col-md-2">
                                            <input class="form-control" name="numero" type="text" value="" ng-model="enderecoCtrl.endereco.numero" required ng-maxlength="150">
                                            <span ng-messages="enderecoForm.numero.$error" ng-show="enderecoForm.numero.$dirty || enderecoForm.$submitted">
                                                <span ng-message="required">@Validacoes.NumeroObrigatorio</span>
                                                <span ng-message="maxLength">@Validacoes.TamanhoMaximo150</span>
                                            </span>
                                        </div>
                                        <div class=" control-label col-md-2">
                                            <label>@Rotulos.Complemento</label>
                                        </div>
                                        <div class="col-md-6">
                                            <input class="form-control" data-val="true" name="Complemento" type="text" value="" ng-model="enderecoCtrl.endereco.complemento" ng-maxlength="150">
                                            <span ng-messages="enderecoForm.numero.$error" ng-show="enderecoForm.numero.$dirty || enderecoForm.$submitted">
                                                <span ng-message="maxLength">@Validacoes.TamanhoMaximo150</span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group" ng-repeat="tel in enderecoCtrl.endereco.telefones track by $index">
                                        <div class="control-label col-md-2" ng-show="$index == 0">
                                            <label>@Rotulos.Telefones</label>
                                        </div>
                                        <div>
                                            <div class="col-md-2" ng-class="{'col-md-offset-2': $index > 0}">
                                                <input class="form-control" id="IdNumero" name="telefone" type="text" value="" ng-model="tel.numero" ng-maxlength="25" required>
                                                <span ng-messages="enderecoForm.telefone.$error" ng-show="enderecoForm.telefone.$dirty || enderecoForm.$submitted">
                                                    <span ng-message="required">@Validacoes.NumeroTelefoneObrigatorio</span>
                                                    <span ng-message="maxLength">@Validacoes.TamanhoMaximoNumeroTelefone</span>
                                                </span>
                                            </div>
                                            <div class="col-md-2" ng-hide="$first">
                                                <button ng-click="enderecoCtrl.removerTelefone($index)" type="button"><img src="~/Content/imagens/remove.png" /></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <div class="col-md-12 col-md-offset-2">
                                            <button type="button" ng-click="enderecoCtrl.adicionarTelefone($index)"><img src="~/Content/imagens/add.png" /></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12 col-md-offset-2">
                                    <input type="submit" class="btn btn-primary" value="@Rotulos.Salvar" />
                                    <button class="btn btn-danger" data-dismiss="modal" onclick="atualizarListaEnderecos();">@Rotulos.Cancelar</button>
                                </div>
                            </div>
                            <div class="modal-footer">
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<input type="hidden" id="endLista" value="@Url.Action("ListaEnderecos", "EnderecosAutoComplete")" />
<input type="hidden" id="estadoSelec" value="@Url.Action("EstadoSelecionado", "EnderecosAutoComplete")" />
<input type="hidden" id="cidadeSelec" value="@Url.Action("CidadeSelecionada", "EnderecosAutoComplete")" />
<input type="hidden" id="bairroSelec" value="@Url.Action("BairroSelecionado", "EnderecosAutoComplete")" />
<input type="hidden" id="autoCidade" value="@Url.Action("AutoCompleteCidade", "EnderecosAutoComplete")" />
<input type="hidden" id="autoBairro" value="@Url.Action("AutoCompleteBairro", "EnderecosAutoComplete")" />
<input type="hidden" id="autoLogradouro" value="@Url.Action("autocompletelogradouro", "EnderecosAutoComplete")">

@*<script src="~/Scripts/Graxei/Administrativo/Enderecos/formularioEndereco.js"></script>*@
@Scripts.Render("~/bundles/modal")
<script type="text/javascript">
    $(function () {
        $('#modalEnderecos').modal('show');
    });

    function atualizarListaEnderecos() {
        $.ajax({
            url: '/Administrativo/Enderecos/Lista?idLoja=@Model.IdLoja',
            type: 'GET',
            success: function (result) {
                $('#fm-content').html(result);
                $('.modal-backdrop').remove();
            }
        });
    }
</script>
